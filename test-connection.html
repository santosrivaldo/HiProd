<!DOCTYPE html>
<html>
<head>
    <title>Teste de Conexão - HiProd API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Teste de Conexão - HiProd API</h1>
    
    <div class="test info">
        <h3>Configuração Atual</h3>
        <p><strong>URL da página:</strong> <span id="current-url"></span></p>
        <p><strong>Hostname:</strong> <span id="hostname"></span></p>
        <p><strong>API URL detectada:</strong> <span id="api-url"></span></p>
    </div>
    
    <button onclick="testSameOrigin()">Testar Same-Origin (/api)</button>
    <button onclick="testLocalhost()">Testar Localhost (8010)</button>
    <button onclick="testDirectPort()">Testar Porta Direta (8010)</button>
    
    <div id="results"></div>
    
    <script>
        // Mostrar configuração atual
        document.getElementById('current-url').textContent = window.location.href;
        document.getElementById('hostname').textContent = window.location.hostname;
        
        // Detectar API URL (mesma lógica do api.js)
        function detectApiUrl() {
            const hostname = window.location.hostname;
            
            if (hostname.includes('grupohi.com.br')) {
                return `${window.location.protocol}//${hostname}/api`;
            }
            
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return 'http://localhost:8010';
            }
            
            return 'http://localhost:8010';
        }
        
        document.getElementById('api-url').textContent = detectApiUrl();
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = `<p>${new Date().toLocaleTimeString()}: ${message}</p>`;
            document.getElementById('results').appendChild(div);
        }
        
        async function testConnection(url, name) {
            addResult(`Testando ${name}: ${url}`, 'info');
            
            try {
                const response = await fetch(url + '/login', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    addResult(`✅ ${name}: Conexão OK (${response.status})`, 'success');
                } else {
                    addResult(`⚠️ ${name}: Resposta ${response.status} - ${response.statusText}`, 'error');
                }
            } catch (error) {
                addResult(`❌ ${name}: Erro - ${error.message}`, 'error');
            }
        }
        
        function testSameOrigin() {
            const url = `${window.location.protocol}//${window.location.hostname}/api`;
            testConnection(url, 'Same-Origin');
        }
        
        function testLocalhost() {
            testConnection('http://localhost:8010', 'Localhost');
        }
        
        function testDirectPort() {
            testConnection('http://localhost:8010', 'Porta Direta');
        }
        
        // Teste automático na detecção
        setTimeout(() => {
            const apiUrl = detectApiUrl();
            testConnection(apiUrl, 'Auto-detectado');
        }, 1000);
    </script>
</body>
</html>
